<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>NodeJs | 陈扬伟的博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/favicon.ico">
    <script language="javascript" type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="/js/MouseClickEffect.js"></script>
    <meta name="description" content="前端、算法笔记与其他干货分享（不断完善中...）">
    
    <link rel="preload" href="/assets/css/0.styles.ad38839b.css" as="style"><link rel="preload" href="/assets/js/app.e99103e4.js" as="script"><link rel="preload" href="/assets/js/2.e098fada.js" as="script"><link rel="preload" href="/assets/js/18.49f0b542.js" as="script"><link rel="prefetch" href="/assets/js/10.e79643c5.js"><link rel="prefetch" href="/assets/js/11.b314eba6.js"><link rel="prefetch" href="/assets/js/12.dc991f9b.js"><link rel="prefetch" href="/assets/js/13.0c351151.js"><link rel="prefetch" href="/assets/js/14.9c0f6b9c.js"><link rel="prefetch" href="/assets/js/15.5ce17fd6.js"><link rel="prefetch" href="/assets/js/16.e22740a0.js"><link rel="prefetch" href="/assets/js/17.3ba60248.js"><link rel="prefetch" href="/assets/js/19.21cfc1c8.js"><link rel="prefetch" href="/assets/js/20.3de85b3c.js"><link rel="prefetch" href="/assets/js/21.7e561d44.js"><link rel="prefetch" href="/assets/js/22.8c4e4893.js"><link rel="prefetch" href="/assets/js/23.a9579cb1.js"><link rel="prefetch" href="/assets/js/24.c20a2a78.js"><link rel="prefetch" href="/assets/js/25.26c1ca37.js"><link rel="prefetch" href="/assets/js/26.5d7a69fd.js"><link rel="prefetch" href="/assets/js/27.9f7ac42f.js"><link rel="prefetch" href="/assets/js/28.d77d8aa4.js"><link rel="prefetch" href="/assets/js/29.fa5a5a0b.js"><link rel="prefetch" href="/assets/js/3.75d96a17.js"><link rel="prefetch" href="/assets/js/30.344875ef.js"><link rel="prefetch" href="/assets/js/31.62517777.js"><link rel="prefetch" href="/assets/js/32.4023b404.js"><link rel="prefetch" href="/assets/js/33.0ff3b040.js"><link rel="prefetch" href="/assets/js/34.e299ff7a.js"><link rel="prefetch" href="/assets/js/35.66d6dd42.js"><link rel="prefetch" href="/assets/js/4.170fa8c2.js"><link rel="prefetch" href="/assets/js/5.02623ce8.js"><link rel="prefetch" href="/assets/js/6.ed1d4fab.js"><link rel="prefetch" href="/assets/js/7.50bce60e.js"><link rel="prefetch" href="/assets/js/8.52590174.js"><link rel="prefetch" href="/assets/js/9.40d0227d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ad38839b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/other/logo.png" alt="陈扬伟的博客" class="logo"> <span class="site-name can-hide">陈扬伟的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blogs/nav/" class="nav-link">
  导航
</a></div><div class="nav-item"><a href="/blogs/frontend/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/blogs/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/blogs/other/" class="nav-link">
  干货
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的" class="dropdown-title"><span class="title">我的</span> <span class="arrow down"></span></button> <button type="button" aria-label="我的" class="mobile-dropdown-title"><span class="title">我的</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/cyw0012/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_66306407?type=blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blogs/nav/" class="nav-link">
  导航
</a></div><div class="nav-item"><a href="/blogs/frontend/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/blogs/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/blogs/other/" class="nav-link">
  干货
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的" class="dropdown-title"><span class="title">我的</span> <span class="arrow down"></span></button> <button type="button" aria-label="我的" class="mobile-dropdown-title"><span class="title">我的</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/cyw0012/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/weixin_66306407?type=blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blogs/frontend/" aria-current="page" class="sidebar-link">前端介绍</a></li><li><a href="/blogs/frontend/html5.html" class="sidebar-link">HTML5</a></li><li><a href="/blogs/frontend/css3.html" class="sidebar-link">CSS3</a></li><li><a href="/blogs/frontend/moveweb.html" class="sidebar-link">移动 web</a></li><li><a href="/blogs/frontend/javascript.html" class="sidebar-link">JavaScript</a></li><li><a href="/blogs/frontend/webapis.html" class="sidebar-link">WebAPIs</a></li><li><a href="/blogs/frontend/es6.html" class="sidebar-link">ES6</a></li><li><a href="/blogs/frontend/jquery.html" class="sidebar-link">jQuery</a></li><li><a href="/blogs/frontend/ajax.html" class="sidebar-link">Ajax</a></li><li><a href="/blogs/frontend/nodejs.html" aria-current="page" class="active sidebar-link">NodeJs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#一、初始-node-js-与内置模块" class="sidebar-link">一、初始 Node.js 与内置模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_1-初始-node-js" class="sidebar-link">(1) 初始 Node.js</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_2-fs-文件系统模块" class="sidebar-link">(2) fs 文件系统模块</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_3-path-路径模块" class="sidebar-link">(3) path 路径模块</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_4-http-模块" class="sidebar-link">(4) http 模块</a></li></ul></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#二、模块化" class="sidebar-link">二、模块化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_1-关于模块化" class="sidebar-link">(1) 关于模块化</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_2-npm-与包" class="sidebar-link">(2) npm 与包</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_3-开发包与发布包" class="sidebar-link">(3) 开发包与发布包</a></li></ul></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#三、express" class="sidebar-link">三、Express</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_1-初始-express" class="sidebar-link">(1) 初始 Express</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_2-路由" class="sidebar-link">(2) 路由</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_3-中间件" class="sidebar-link">(3) 中间件</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_4-用-express-写接口" class="sidebar-link">(4) 用 Express 写接口</a></li></ul></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#四、数据库与身份认证" class="sidebar-link">四、数据库与身份认证</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_1-数据库的基本知识" class="sidebar-link">(1) 数据库的基本知识</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_2-使用" class="sidebar-link">(2) 使用</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_3-web-开发模式" class="sidebar-link">(3) Web 开发模式</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_4-身份认证" class="sidebar-link">(4) 身份认证</a></li></ul></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#五、补充与总结" class="sidebar-link">五、补充与总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_1-密码加密" class="sidebar-link">(1) 密码加密</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_2-表单数据验证" class="sidebar-link">(2) 表单数据验证</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_3-流程步骤总结" class="sidebar-link">(3) 流程步骤总结</a></li><li class="sidebar-sub-header"><a href="/blogs/frontend/nodejs.html#_4-其他" class="sidebar-link">(4) 其他</a></li></ul></li></ul></li><li><a href="/blogs/frontend/vue2.html" class="sidebar-link">Vue2</a></li><li><a href="/blogs/frontend/vue3.html" class="sidebar-link">Vue3</a></li><li><a href="/blogs/frontend/typescript.html" class="sidebar-link">TypeScript</a></li><li><a href="/blogs/frontend/react.html" class="sidebar-link">React</a></li><li><a href="/blogs/frontend/wechat.html" class="sidebar-link">微信小程序</a></li><li><a href="/blogs/frontend/demo.html" class="sidebar-link">案例分享</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nodejs"><a href="#nodejs" class="header-anchor">#</a> NodeJs</h1> <h2 id="一、初始-node-js-与内置模块"><a href="#一、初始-node-js-与内置模块" class="header-anchor">#</a> 一、初始 Node.js 与内置模块</h2> <p>js 引擎负责解析和执行 JavaScript 代码；内置 API 是由运行环境提供的特殊接口，只能在所属的运行环境中被调用。</p> <h3 id="_1-初始-node-js"><a href="#_1-初始-node-js" class="header-anchor">#</a> (1) 初始 Node.js</h3> <ol><li><p>Node.js 是一个基于 V8 的 javascript 运行环境（后端）。</p> <img src="/blog_img/nodejs_01.png"> <ul><li><p>浏览器是 js 的前端运行环境；</p></li> <li><p>Node.js 是 js 的后端运行环境；</p></li> <li><p>Node.js 无法调用 DOM 和 BOM 等浏览器内置 API</p></li></ul></li> <li><p>Node 的作用</p> <ul><li><p>基于 Express 框架(<a href="http://www.expressjs.com.cn" target="_blank" rel="noopener noreferrer">网址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)，可以快速构建 Web 应用</p></li> <li><p>基于 Electron 框架(<a href="https://electronjs.org" target="_blank" rel="noopener noreferrer">网址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)，可以构建跨平台的桌面应用</p></li> <li><p>基于 restify 框架(<a href="http://restify.com" target="_blank" rel="noopener noreferrer">网址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)，可以快速构建 API 接口项目</p></li> <li><p>读写和操作数据库、创建实用的命令行工具辅助前端开发、etc...</p></li></ul></li> <li><p>学习路径</p> <p>js 基础语法-》Node.js 内置 API 模块(fs、path、http)-》第三方 API 模块(express、mysql)</p></li> <li><p>安装（<a href="https://nodejs.org/zh-cn/" target="_blank" rel="noopener noreferrer">Node.js (nodejs.org)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</p> <p>查看版本号（检验安装是否成功）：在终端输入 node -v 命令</p> <p>终端：专门为开发人员设计，用于实现人机交互</p></li> <li><p>在 Node.js 环境中执行 JavaScript</p> <p>打开终端-》切换到要执行 js 的目录-》node js 文件.js</p></li></ol> <h3 id="_2-fs-文件系统模块"><a href="#_2-fs-文件系统模块" class="header-anchor">#</a> (2) fs 文件系统模块</h3> <p>fs 模块是 Node.js 官方提供的、用来操作文件的模块</p> <p>导入 fs：const fs = require('fs')</p> <ol><li><p><code>fs.readFile(path[,options],callback)</code>读取文件</p> <p>参数：路径、编码格式、回调函数(可拿到读取结果)</p> <p>回调函数：function(err,dataStr){} err 为读取失败(如成功为 null)，dataStr 为读取成功</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./files/11.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取失败！'</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取成功！'</span> <span class="token operator">+</span> data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>fs.writeFile(file,data[,options],callback)</code>写文件</p> <p>参数：路径、写入内容、编码格式、回调函数</p> <p><strong>此操作会替换掉文件原有内容</strong>，如果路径下没有文件则会自动创建，<strong>但不能创建(路径)文件夹</strong>，</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'G:/files/2.txt'</span><span class="token punctuation">,</span> <span class="token string">'abcd'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(err);</span>
  <span class="token comment">// 写入成功为null,否则为一个错误对象</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'写入失败'</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>路径动态拼接问题：代码在运行时，会以执行 node 命令时所处的目录，动态拼接被操作文件的完整路径。</p> <p>解决办法：改为绝对路径，移植性查、不利于维护；__dirname(表示所处文件目录)+相对目录</p></div> <h3 id="_3-path-路径模块"><a href="#_3-path-路径模块" class="header-anchor">#</a> (3) path 路径模块</h3> <p>path 模块用于处理路径的模块。</p> <p>导入 fs：const path = require('path')</p> <ol><li><p>path.join()：将多个路径拼接；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/a'</span><span class="token punctuation">,</span> <span class="token string">'b/c'</span><span class="token punctuation">,</span> <span class="token string">'../'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">)</span>
<span class="token comment">// ../会抵消一级</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token comment">// /a\b\d\e</span>
</code></pre></div></li> <li><p>path.basename()：从路径字符串中，将文件名解析出；</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> fpath <span class="token operator">=</span> <span class="token string">'a/f/ww/fd/index.html'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>fpath<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 传第二个参数可去除扩展名</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>fpath<span class="token punctuation">,</span> <span class="token string">'.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>path.extname()：获取路径文件的扩展名；</p></li></ol> <h3 id="_4-http-模块"><a href="#_4-http-模块" class="header-anchor">#</a> (4) http 模块</h3> <p>http 模块用于创建 web 服务器。</p> <p>导入 http：const http= require('http')</p> <ol><li><p>服务器相关概念：</p> <ul><li><p>服务器与普通电脑的区别，服务器上有 web 服务器软件（IIS、Apache）</p></li> <li><p>IP 地址：每台计算机唯一的地址；点分十进制(如 192.168.1.1)；互联网中的每台 Web 服务器都有自己 IP 地址(如 ping www.baidu.com)</p></li></ul> <p>测试自己电脑：127.0.0.1</p> <ul><li><p>域名：给 IP 地址起的别名；IP 地址和域名存在一一对应关系，关系存放在域名服务器(DNS)，DNS 可将域名转换为 IP 地址。</p> <p>127.0.0.1 的域名为 localhost</p></li> <li><p>端口号：每个 web 服务对应一个唯一端口号。</p></li></ul> <p>每个端口不可同时被多个 web 服务占用；URL 中 80 端口可省略</p></li> <li><p>创建 web 服务器的步骤：</p> <details class="custom-block details"><summary>展开代码</summary> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 1.导入http模块</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token comment">// 2.创建web服务器实例</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 3.为服务器实例绑定request事件，监听客户端请求</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Someone visit our web server'</span><span class="token punctuation">)</span>
  <span class="token comment">//req请求对象：访问客户端的数据或对象</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>url
  <span class="token keyword">const</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span>method
  <span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You request url </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> , and method </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
  <span class="token comment">//You request url /about.html , and method POST</span>

  <span class="token comment">// res响应对象</span>
  <span class="token keyword">const</span> str2 <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">你请求的 url 为 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> , 然后 method 为 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token comment">// 解决中文乱码：手动设置内容编码</span>
  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html; charset=utf-8'</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 4.启动服务器</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server running at http://127.0.0.1:8080'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></details> <p>终端输入 CTRL+C 停止服务器</p></li></ol> <h2 id="二、模块化"><a href="#二、模块化" class="header-anchor">#</a> 二、模块化</h2> <h3 id="_1-关于模块化"><a href="#_1-关于模块化" class="header-anchor">#</a> (1) 关于模块化</h3> <ol><li><p>模块化的基本概念：</p> <p>可组合、分解和更换的单元。</p> <p>好处：提高了复用性、可维护性，实现了按需加载。</p></li> <li><p>Node.js 中的模块化：</p> <ul><li><p>三大类：内置模块、自定义模块、第三方模块</p></li> <li><p>加载模块：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 加载内置模块、第三方模块</span>
<span class="token keyword">const</span> m1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'XXX'</span><span class="token punctuation">)</span>
<span class="token comment">// 加载自定义模块(可省略.js后缀名)</span>
<span class="token keyword">const</span> m1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./04-m1'</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li> <li><p>模块作用域：</p> <p>在自定义模块中定义的变量、方法等成员，只能在当前模块内被访问。</p> <ul><li><p>作用：防止全局变量污染的问题</p></li> <li><p>module(代表当前模块)：存储了和当前模块有关的信息。</p></li> <li><p>module.exports(对外的接口)：共享了当前模块成员的对象。<u>导入模块时永远以 module.exports 指向的对象为准</u>。（exports 指向同一个对象）</p></li> <li><p>模块规范(CommonJS)：规定了模块的特性和各模块之间如何相互依赖。</p></li></ul></li></ol> <h3 id="_2-npm-与包"><a href="#_2-npm-与包" class="header-anchor">#</a> (2) npm 与包</h3> <p><a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer">全球最大的包共享平台<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Node.js 中的第三方模块又叫包，包是基于内置模块封装出来的。</p> <p>包管理工具：Node Package Manager</p> <ol><li><p>常用命令：</p> <p>查看 npm 包管理工具版本：<code>npm -v</code></p> <p>下载包：<code>npm i XXX[@指定版本号]</code> （<u>默认为最新版；空格分隔下载多个包；未指定包名则读取 dependencies 节点下的所有包</u>）</p> <p>卸载包：<code>npm uninstall</code></p></li> <li><p>使用步骤：下包-&gt;导包-&gt;参考 api 文档使用</p> <blockquote><p>下载包的服务器：https://registry.npmjs.org</p></blockquote> <p>node_modules 文件夹用来存放安装到项目的包。</p> <p>package-lock.json 记录 node_modules 目录下的每一个包的下载信息。</p> <p>语义化版本规范：点分十进制(大版本、功能版本、Bug 修复版本)</p></li> <li><p>包管理配置文件：</p> <p>第三方包体积大，不方便共享，<strong>解决方案是剔除 node_modules</strong></p> <p>包管理配置信息(package.json)：记录项目安装了哪些包。</p> <p><strong>如果项目上线后不会用到则把包记录到 devDependencies 节点中，否则记录到 dependencies。</strong></p> <div class="language- extra-class"><pre class="language-text"><code># 把包记录到 devDependencies 节点
npm install 包名 --save-dev
# 简写
npm i 包名 -D
</code></pre></div></li> <li><p>解决下包速度慢：原因是默认从国外服务器下载</p> <p>淘宝 NPM 镜像服务器：把国外的包同步到国内供国内用户下载。</p> <p>镜像：是一种文件存储形式，一个磁盘上的数据在另一个磁盘上存在一个相同的副本。</p> <p>切换 npm 下包镜像：</p> <div class="language- extra-class"><pre class="language-text"><code># 查看当前的下包镜像
npm config get registry

# 将下包的镜像源切换为淘宝镜像源
npm config set registry=https://registry.npm.taobao.org/

# 检查镜像是否下载成功
npm config get registry
</code></pre></div><p>nrm：此工具可快速查看和切换下包的镜像源。</p> <div class="language- extra-class"><pre class="language-text"><code># 将 nrm 安装为全局可用的工具
npm i nrm -g

# 查看所有可用的镜像源
nrm ls

# 查看当前镜像源
npm config get registry

# 切换到指定镜像
nrm use taobao
</code></pre></div></li> <li><p>包的分类：</p> <ul><li><p>项目包：开发依赖包(devDependencies)、核心依赖包(dependencies)</p></li> <li><p>全局包：C:\Users\用户名文件夹\AppData\Roaming\npm\node_modules</p></li></ul> <p>安装、卸载时加入 -g 参数</p></li> <li><p>工具：</p> <ul><li>nodemon：监听项目文件的变动，自动重启项目</li></ul> <div class="language- extra-class"><pre class="language-text"><code># 全局安装
npm i -g nodemon

# 使用
nodemon app.js
</code></pre></div><ul><li>i5ting_toc：将 md 文件转 html 的工具</li></ul> <div class="language- extra-class"><pre class="language-text"><code># 安装
npm i -g i5ting_toc

# 将md文件转html的工具
i5ting_toc -f 路径 -o
</code></pre></div></li> <li><p>规范的包结构：</p></li></ol> <p>包必须以单独目录存在；顶级目录下必须包含 package.json；package.json 必须包含 name、version、main。</p> <h3 id="_3-开发包与发布包"><a href="#_3-开发包与发布包" class="header-anchor">#</a> (3) 开发包与发布包</h3> <ol><li><p>package.json</p> <ul><li><p>&quot;description&quot;：对包的描述</p></li> <li><p>&quot;keywords&quot;：数组，搜索关键词</p></li> <li><p>&quot;license&quot;：遵守协议</p></li></ul></li> <li><p>注册账号：<a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer">全球最大的包共享平台<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>登录 npm 账号：</p> <p>终端输入(<strong>需切换到 npm 官方服务器</strong>)</p> <div class="language- extra-class"><pre class="language-text"><code>npm login
</code></pre></div></li> <li><p>切换到根目录，发布包：(不能和别人的同名)</p> <div class="language- extra-class"><pre class="language-text"><code>npm publish
</code></pre></div></li> <li><p>删除包：</p> <div class="language- extra-class"><pre class="language-text"><code>npm uni
# 只能删除72小时内发布的包
# 删除的包在24小时内不可重复发布
# 尽量不要发布没有意义的包
npm unpublish 包名 --force
</code></pre></div></li></ol> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>模块的加载机制:</p> <p><strong>模块在第一次加载后会被缓存。(优先从缓存中加载提高模块的加载效率)</strong></p> <p>内置模块是官方提供的，加载优先级最高。</p> <p>自定义模块、补全.js、补全.json、补全.node、终端报错。</p> <p>第三方模块，从 /node_modules 开始找，一级一级往上找，直到系统根目录。</p></div> <h2 id="三、express"><a href="#三、express" class="header-anchor">#</a> 三、Express</h2> <h3 id="_1-初始-express"><a href="#_1-初始-express" class="header-anchor">#</a> (1) 初始 Express</h3> <p>基于 Node.js 平台，快速、开发、极简的 Web 开发框架。Express 的本质是提供了快速创建 Web 服务器的第三方包。</p> <p><a href="https://www.expressjs.com.cn/" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>常见两种服务器：Web 网站服务器、API 接口服务器。</p> <p>安装：<code>npm i express@4.17.1</code></p> <ol><li><p>创建服务器</p> <details class="custom-block details"><summary>展开代码</summary> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建服务器</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 监听客户端的 GET 和 POST 请求，并响应内容</span>
<span class="token comment">// app.get('/user', function (req, res) {</span>
<span class="token comment">//   // req.query可查询参数（默认为空对象）</span>
<span class="token comment">//   console.log(req.query);</span>

<span class="token comment">//   res.send(req.query)</span>
<span class="token comment">// })</span>

<span class="token comment">// :id是一个动态参数</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id/:name'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// req.params 动态匹配 URL 参数（默认为空对象）</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>

  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 启动服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></details></li> <li><p>托管静态资源</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 挂载路径前缀</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/clock'</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'./clock'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <h3 id="_2-路由"><a href="#_2-路由" class="header-anchor">#</a> (2) 路由</h3> <p>指客户端的请求与服务器处理函数之间的映射关系。</p> <img src="/blog_img/nodejs_02.png"> <ol><li><p>模块化路由：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 这是路由模块</span>
<span class="token comment">// 1. 导入 express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 创建路由对象</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 3. 挂载路由</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/list'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Get user list'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user/add'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Post new user'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 4. 暴露路由</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre></div></li> <li><p>使用路由：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 1. 导入路由模块</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./03-router'</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 注册路由模块</span>
<span class="token comment">// app.use() 函数的作用，就是来注册全局中间件</span>
<span class="token comment">// 挂载统一访问前缀</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'80'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <h3 id="_3-中间件"><a href="#_3-中间件" class="header-anchor">#</a> (3) 中间件</h3> <img src="/blog_img/nodejs_03.png"> <p><strong>中间件的作用</strong>：共享同一份 req 和 res，可供下游的中间件或路由使用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 中间件的形参列表中必须包含next参数。</span>
<span class="token comment">// next 函数是实现多个中间件连续调用的关键，处理完转交给下一个中间件和路由。</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这是一个最简单的中间件'</span><span class="token punctuation">)</span>

  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//可定义多个中间件，依次执行</span>
</code></pre></div><ol><li><p>使用局部中间件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">mw1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用了局部生效的中间件1'</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">mw2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用了局部生效的中间件2'</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>mw1<span class="token punctuation">,</span> mw2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Home page'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>五个注意事项</p> <ul><li><p>一定要在路由之前注册中间件</p></li> <li><p>客户端发送过来的请求，可以连续调用多个中间件进行处理</p></li> <li><p>执行完中间件的业务代码之后，不要忘记调用 next()函数</p></li> <li><p>为了防止代码逻辑混乱，调用 next()函数后不要再写额外的代码</p></li> <li><p>连续调用多个中间件时，多个中间件之间 共享 req 和 res 对象</p></li></ul></li> <li><p>中间件的分类</p> <ul><li>应用级别的中间件</li></ul> <p>绑定到 app 实例上的中间件</p> <ul><li>路由级别的中间件</li></ul> <p>绑定到 express.Router() 实例上的中间件</p> <ul><li>错误级别的中间件</li></ul> <p>必须在所有路由之后</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'发生错误：'</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'发生错误：'</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>Express 内置的中间件</p> <ul><li><p>express.static 快速托管静态资源的内置中间件</p></li> <li><p>express.json 解析 JSON 格式的请求数据</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 配置解析 application/json 格式数据的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>express.urlencoded 解析 URL-encoded 格式数据</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 配置解析 application/x-www-form-urlencoded 格式数据的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>第三方中间件</p> <ul><li><p>安装：npm i body-parser</p></li> <li><p>导入：<code>const bodyPaeser = require('body-parser')</code></p></li> <li><p>注册中间件：<code>app.use(parser.urlencoded({ extended: false }));</code></p></li></ul></li> <li><p>自定义中间件</p> <details class="custom-block details"><summary>展开代码</summary> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> qs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">bodyParser</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 定义中间件的业务逻辑</span>
  <span class="token comment">// 1. 监听数据请求事件</span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    str <span class="token operator">+=</span> chunk
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 2. 监听请求结束事件</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 把字符串的请求体数据，解析成对象格式</span>
    <span class="token keyword">const</span> body <span class="token operator">=</span> qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
    req<span class="token punctuation">.</span>body <span class="token operator">=</span> body
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> bodyParser
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> customBodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./13-custom-body-parser'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>customBodyParser<span class="token punctuation">)</span>
</code></pre></div></details></li></ul></li></ol> <h3 id="_4-用-express-写接口"><a href="#_4-用-express-写接口" class="header-anchor">#</a> (4) 用 Express 写接口</h3> <ol><li><p>CORS 中间件</p> <p>解决跨域问题（要在路由之前）。cors 是由一系列 HTTP 响应头组成，从而决定了浏览器是否阻止前端 JS 代码跨域获取资源。</p> <p>注意事项：</p> <ul><li><p>CORS 主要在服务器端进行配置，客户端浏览器无需配置。</p></li> <li><p>CORS 在浏览器有兼容性问题。</p></li></ul> <p>限制网站访问接口：</p> <div class="language-js extra-class"><pre class="language-js"><code>res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>CORS 响应头部</p> <ul><li><p>发送额外请求头信息</p> <p>默认情况下，CORS 仅支持客户端向服务器发送如下的 9 个请求头：
Accept、Accept-Language、Content-Language、DPR、Downlink、Save-Data、 Viewport-Width、Width、Content-Type (值仅限于 text/plain、multipart/form-data、application/x-www-form-urlencoded 三者之一)</p> <div class="language-js extra-class"><pre class="language-js"><code>res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span>
  <span class="token string">'Access-Control-Allow-Headers'</span><span class="token punctuation">,</span>
  <span class="token string">'Content-Type'</span><span class="token punctuation">,</span>
  <span class="token string">'X-Custom-Header'</span>
<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>发送其他请求</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>// 只允许POST、GET、DELETE、HEAD请求方法
res.setHeader('Access-Control-Allow-Methods','POST,GET,DELETE,HEAD')
// 允许所有的HTTP请求方法
res.setHeader('Access-Control-Allow-Methods','*')
</code></pre></div></li> <li><p>CORS 请求分类</p> <ul><li><p>简单请求：</p> <p>请求方式为 GET、POST、HEAD</p></li> <li><p>预检请求</p> <p>请求方式为 GET、POST、HEAD 之外的请求 Method 类型；请求头中包含自定义头部字段；向服务器发送了 application/json 格式的数据。</p> <p>在浏览器与服务器正式通信之前，浏览器会先发送 OPTION 请求进行预检，以获知服务器是否允许该实际请求，所以这次的 OPTION 请求称为“预检请求”，服务器成功响应预检请求后，才会发送真正的清求，并且携带真实数据。</p></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>两种请求的区别：简单请求，客户端与服务端之间只发生一次请求；预检请求，则发生两次请求，OPTION 预检请求成功后发起真正的请求。</p></div></li></ol> <h2 id="四、数据库与身份认证"><a href="#四、数据库与身份认证" class="header-anchor">#</a> 四、数据库与身份认证</h2> <h3 id="_1-数据库的基本知识"><a href="#_1-数据库的基本知识" class="header-anchor">#</a> (1) 数据库的基本知识</h3> <ol><li><p>数据库的基本概念：用来组织、存储、管理 数据的仓库。</p> <ul><li><p>传统型数据库（关系型数据库）：MySQL（开源免费）、Orale（收费）、SQL Server（收费）</p></li> <li><p>非关系型数据库：Mongodb（Community + Enterprise）</p></li></ul></li> <li><p>数据组织结构：数据库、数据表、数据行、字段。</p> <ul><li><p>DataType：int(正数)、varchar(len)(字符串)、tinyint(1)布尔值</p></li> <li><p>PK(Primary Key)(主键、唯一标识)、NN(Not Null)(值不允许为空)、UQ(Unique)(值唯一)、AI(Auto Increment)(值自动增长)</p></li></ul></li> <li><p>SQL：结构化查询语言；数据库编程语言；SQL 语言编写的为 SQL 语句；SQL 语言只能在关系型数据库中使用。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查询所有数据库</span>
<span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
<span class="token comment">-- 查询数据库中所有表</span>
<span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
<span class="token comment">-- 查询表中所有数据</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> 表名
<span class="token comment">-- 插入数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> users <span class="token punctuation">(</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&quot;老六&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 更新数据</span>
<span class="token keyword">update</span> users <span class="token keyword">set</span> password<span class="token operator">=</span><span class="token string">&quot;admin123&quot;</span><span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">-- 删除数据</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>
<span class="token comment">-- where子句用于限定选择标准</span>
</code></pre></div><table><thead><tr><th>操作符</th> <th>描述</th></tr></thead> <tbody><tr><td>=</td> <td>等于</td></tr> <tr><td>&lt;&gt;</td> <td>不等于</td></tr> <tr><td>&gt;</td> <td>大于</td></tr> <tr><td>&lt;</td> <td>小于</td></tr> <tr><td>&gt;=</td> <td>大于等于</td></tr> <tr><td>&lt;=</td> <td>小于等于</td></tr> <tr><td>BETWEEN</td> <td>在某个范围内</td></tr> <tr><td>LIKE</td> <td>搜索某种模式</td></tr></tbody></table> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- and运算符、or运算符</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">and</span> id<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">or</span> username<span class="token operator">=</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">;</span>
<span class="token comment">-- order by(默认升序asc)</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token keyword">status</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token keyword">status</span> <span class="token keyword">desc</span><span class="token punctuation">;</span>
<span class="token comment">-- 多重排序</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token keyword">status</span> <span class="token keyword">desc</span><span class="token punctuation">,</span>username <span class="token keyword">asc</span><span class="token punctuation">;</span>
<span class="token comment">-- 查询数据条数</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">-- 为列设置别名</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> total <span class="token keyword">from</span> users <span class="token keyword">where</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> username <span class="token keyword">as</span> un<span class="token punctuation">,</span> password <span class="token keyword">as</span> pw <span class="token keyword">from</span> users <span class="token keyword">where</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div><p>多表查询：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 左连接(以左表为主表)</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">left</span> <span class="token keyword">join</span> article <span class="token keyword">on</span> users<span class="token punctuation">.</span>id <span class="token operator">=</span> article<span class="token punctuation">.</span>userid
<span class="token comment">-- 右连接(以右表为主表)</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">right</span> <span class="token keyword">join</span> article <span class="token keyword">on</span> users<span class="token punctuation">.</span>id <span class="token operator">=</span> article<span class="token punctuation">.</span>userid
<span class="token comment">-- 内连接(取交集)</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">inner</span> <span class="token keyword">join</span> article <span class="token keyword">on</span> users<span class="token punctuation">.</span>id <span class="token operator">=</span> article<span class="token punctuation">.</span>userid
<span class="token comment">-- 外连接(取并集)</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">outer</span> <span class="token keyword">join</span> article <span class="token keyword">on</span> users<span class="token punctuation">.</span>id <span class="token operator">=</span> article<span class="token punctuation">.</span>userid
<span class="token comment">-- 纵向连接(union会删除重复值；union all不删除重复值)</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">left</span> <span class="token keyword">join</span> article <span class="token keyword">on</span> users<span class="token punctuation">.</span>id <span class="token operator">=</span> article<span class="token punctuation">.</span>userid
<span class="token keyword">union</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">right</span> <span class="token keyword">join</span> article <span class="token keyword">on</span> users<span class="token punctuation">.</span>id <span class="token operator">=</span> article<span class="token punctuation">.</span>userid
</code></pre></div></li></ol> <h3 id="_2-使用"><a href="#_2-使用" class="header-anchor">#</a> (2) 使用</h3> <ol><li><p>安装： npm i mysql</p></li> <li><p>导入、连接：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 导入 mysql 模块</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 建立与 MySQL 数据库的连接关系</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token comment">// 数据库的IP</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span> <span class="token comment">// 登录数据库的账号</span>
  <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span> <span class="token comment">// 登录数据库的密码</span>
  <span class="token literal-property property">database</span><span class="token operator">:</span> <span class="token string">'my_db_01'</span><span class="token punctuation">,</span> <span class="token comment">// 指定操作数据库</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>查询、插入、更新、删除：db.query()</p></li></ol> <h3 id="_3-web-开发模式"><a href="#_3-web-开发模式" class="header-anchor">#</a> (3) Web 开发模式</h3> <ol><li><p>服务器端渲染：服务器发送给客户端的 HTML 页面，是在服务器通过字符串的拼接，动态生成的。</p> <p>优点：</p> <ul><li><p>前端耗时少。因为服务器端负责动态生成 HTML 内容，浏览器只需要直接渲染页面即可。尤其是移动端，更省电。</p></li> <li><p>有利于 SEO。因为服务器端响应的是完整的 HTML 页面内容，所以爬虫更容易爬取获得信息，更有利于 SEO。</p></li></ul> <p>缺点：</p> <ul><li><p>占用服务器端资源。即服务器端完成 HTML 页面内容的拼接，如果请求较多，会对服务器造成一定的访问压力。</p></li> <li><p>不利于前后端分离，开发效率低。使用服务器端清染，则无法进行分工合作，尤其对于前端复杂度高的项目，不利于项目高效开发。</p></li></ul></li> <li><p>前后端分离：前端通过 Ajax 调用 api 接口。</p> <p>优点：</p> <ul><li><p>开发体验好。前端专注于 U1 页面的开发，后端专注于 pi 的开发，且前端有更多的选择性。</p></li> <li><p>用户体验好。Ajx 技术的广泛应用，极大的提高了用户的体验，可以轻松实现页面的局部刷新。</p></li> <li><p>减轻了服务器端的渲染压力。因为页面最终是在每个用户的览器中生成的。</p></li></ul> <p>缺点：</p> <ul><li>不利于 SEO。因为完整的 HTML 页面需要在客户端动态拼接完成，所以爬虫对无法爬取页面的有效信息，（解决方案：利用 Vue、React 等前惴框架的 SSR(server side render)技术能够很好的解决 SEO 问题！）</li></ul></li> <li><p>如何选择 Web 开发模式：具体使用何种开发模式并不是绝对的。</p> <ul><li><p>服务器端渲染：比如企业级网站，主要功能是展示而没有复杂的交互，并且需要良好的 SO。</p></li> <li><p>前后端分离：而类似后台管理项目，交互性比较强，不需要考虑 SEO。</p></li> <li><p>首屏服务器端渲染+其他页面前后端分离：为了同时兼顾了首页的渲染速度和前后端分离的开发效率。</p></li></ul></li></ol> <h3 id="_4-身份认证"><a href="#_4-身份认证" class="header-anchor">#</a> (4) 身份认证</h3> <p>通过一定的手段，完成对用户身份的认证。</p> <p>服务器端渲染推荐使用 Session 认证机制；前后端分离推荐使用 JWT 认证机制。</p> <ol><li><p>Session 认证机制</p> <p>HTTP 协议的无状态性：每次 HTTP 请求都是独立的，服务器不会主动保留每次 HTTP 请求的状态。</p> <p>Cookie：存储在用户浏览器中的一段不超过 4KB 的字符串。自动发送、域名独立、过期时限、4KB 限制。（不具有安全性，容易被伪造，不要使用其存储隐私信息）</p> <p>Session 的工作原理：</p> <img src="/blog_img/nodejs_04.png"> <p>使用：</p> <ul><li><p>安装：npm i express-session</p></li> <li><p>配置中间件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'session'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">'itheima'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">resave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div></li></ul></li> <li><p>JWT 认证机制</p> <p>Session 认证不能解决跨域（跨域需要做许多配置）</p> <p>JWT(JSON Web Token)：最流行的跨域认证机制</p> <p>工作原理：</p> <img src="/blog_img/nodejs_05.png"> <p>JWT 的组成部分：Header(头部).Payload(有效荷载).Signature(签名)</p> <p>Payload 为用户信息；Header、Signature 保证安全性。</p> <p>每次通信需携带 JWT 字符串，推荐把 JWT 放在 HTTP 请求头的 Authorization 字段中，格式：<code>Authorization: Bearer &lt;token&gt;</code></p> <div class="custom-block danger"><p class="custom-block-title">DANGER</p> <p>注：Payload 存放了用户信息，采用了 base64 编码，它并未加密，所以不要把私密信息存放到 JWT 中，JWT 能起到的作用是防篡改。若要存放私密信息请单独加密。</p></div> <p>使用：</p> <ul><li><p>安装相关包：npm i jsonwebtoken express-jwt</p> <p>jsonwebtoken 用于生成 JWT 字符串；express-jwt 用于将 JWT 字符串还原成 JSON 对象。</p></li> <li><p>导入：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在 app.js 中导入（用于解析Token）</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">expressjwt</span><span class="token operator">:</span> expressJWT <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-jwt'</span><span class="token punctuation">)</span>
<span class="token comment">// 在登录的处理函数模块中导入（用于生成Token）</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>定义 secret 密钥：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> secretKey <span class="token operator">=</span> <span class="token string">'itheima No1 ^_^'</span>
</code></pre></div></li> <li><p>在登录成功后生成 JWT 字符串：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> tokenStr <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">username</span><span class="token operator">:</span> userinfo<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  secretKey<span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token string">'30s'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// 然后发送给客户端</span>
res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'登录成功！'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">token</span><span class="token operator">:</span> <span class="token string">'Bearer '</span> <span class="token operator">+</span> tokenStr<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>将 JWT 字符串还原为 JSON 对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 可自动挂载用户信息到 req.auth上,unless指定哪些接口不需要进行 Toke 的验证</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">expressJWT</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">secret</span><span class="token operator">:</span> secretKey<span class="token punctuation">,</span>
    <span class="token literal-property property">algorithms</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'HS256'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unless</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/api\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>捕获解析 JWT 失败后产生的错误：</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'UnauthorizedError'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">401</span><span class="token punctuation">,</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'无效的token！'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'未知的错误！'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li></ol> <h2 id="五、补充与总结"><a href="#五、补充与总结" class="header-anchor">#</a> 五、补充与总结</h2> <h3 id="_1-密码加密"><a href="#_1-密码加密" class="header-anchor">#</a> (1) 密码加密</h3> <p>无法逆向破解，加密结果各不相同</p> <ol><li><p>安装：npm i bcryptjs</p></li> <li><p>导入：const bcrypt = require('bcryptjs')</p></li> <li><p>加密：bcrypt.hashSync(明文密码,随机盐的长度)</p></li> <li><p>解密：bcrypt.compareSync(提交密码,数据库密码)</p></li></ol> <h3 id="_2-表单数据验证"><a href="#_2-表单数据验证" class="header-anchor">#</a> (2) 表单数据验证</h3> <ol><li><p>安装：</p> <p>验证规则：npm i joi</p> <p>自动对表单数据验证：npm i @escook/express-joi</p></li> <li><p>在 schema 模块中自定义规则</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> joi <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'joi'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> username <span class="token operator">=</span> joi
  <span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pattern</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[a-z]{3,9}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> password <span class="token operator">=</span> joi
  <span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pattern</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,14}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

exports<span class="token punctuation">.</span>reguser_sc <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">,</span>
    password<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>在 router 模块中使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 导入校验数据的包</span>
<span class="token keyword">const</span> expressJoi <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@escook/express-joi'</span><span class="token punctuation">)</span>
<span class="token comment">// 导入校验规则</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> reguser_sc <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../schema/user'</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/reguser'</span><span class="token punctuation">,</span> <span class="token function">expressJoi</span><span class="token punctuation">(</span>reguser_sc<span class="token punctuation">)</span><span class="token punctuation">,</span> userHd<span class="token punctuation">.</span>reguser<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>配置错误中间件：</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">Joi<span class="token punctuation">.</span>ValidationError</span><span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">cc</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <h3 id="_3-流程步骤总结"><a href="#_3-流程步骤总结" class="header-anchor">#</a> (3) 流程步骤总结</h3> <p>安装基本模块(express)；创建一个简单服务器；配置 cors 模块解决跨域；配置解析表单中间件；初始化路由模块并且导入注册；抽离路由模块的处理函数；MySQL 建表；安装并配置 mysql 模块；检测用户名是否占用；对密码进行加密进行插入数据；代码优化。</p> <h3 id="_4-其他"><a href="#_4-其他" class="header-anchor">#</a> (4) 其他</h3> <ol><li><p>关于获取发送请求的数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Params 数据（字符串拼接）</span>
req<span class="token punctuation">.</span>query
<span class="token comment">// Body 数据</span>
req<span class="token punctuation">.</span>body
<span class="token comment">// /:id</span>
req<span class="token punctuation">.</span>params
</code></pre></div></li> <li><p>npm 下载报错</p> <p><code>npm cache clear --force</code> （npm 缓存清除--强制）</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blogs/frontend/ajax.html" class="prev">
        Ajax
      </a></span> <span class="next"><a href="/blogs/frontend/vue2.html">
        Vue2
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 陈扬伟的博客
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="http://music.163.com/song/media/outer/url?id=2049512697.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="right:10px;bottom:275px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="http://p1.music.126.net/TmOHxaGnFNlwNX8aPz66oA==/109951168638913915.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="right:10px;bottom:275px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(http://p1.music.126.net/TmOHxaGnFNlwNX8aPz66oA==/109951168638913915.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>向云端</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>小霞</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div><div></div></div></div>
    <script src="/assets/js/app.e99103e4.js" defer></script><script src="/assets/js/2.e098fada.js" defer></script><script src="/assets/js/18.49f0b542.js" defer></script>
  </body>
</html>
